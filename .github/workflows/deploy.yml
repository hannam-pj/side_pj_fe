name: Deploy to Synology NAS

on:
  push:
    branches: [ main ]  # main 브랜치에 푸시하면 실행

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: executing remote ssh commands using password
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.NAS_HOST }}
          username: ${{ secrets.NAS_USER }}
          password: ${{ secrets.NAS_PWD }}
          port: ${{ secrets.NAS_PORT }}
          script: |
            # 1. 프로젝트 폴더로 이동
            cd /volume1/docker/side_pj_fe/side_pj_fe
            # 2. 코드 업데이트
            git pull origin main
            # 3. 배포 (나스 본체에서 직접 실행하므로 경로 문제가 없습니다)
            sudo docker compose up -d --build